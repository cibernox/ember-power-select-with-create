{"version":3,"file":"power-select-with-create.js","sources":["../../src/components/power-select-with-create.js"],"sourcesContent":["import { assert } from '@ember/debug';\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { get, action } from '@ember/object';\nimport RSVP, { resolve } from 'rsvp';\nimport PowerSelectComponent from 'ember-power-select/components/power-select';\nimport {\n  filterOptions,\n  defaultMatcher,\n} from 'ember-power-select/utils/group-utils';\nimport { ensureSafeComponent } from '@embroider/util';\nimport SuggestedOptionComponent from './power-select-with-create/suggested-option.js';\n\nexport default class PowerSelectWithCreateComponent extends Component {\n  matcher = defaultMatcher;\n\n  @tracked\n  searchEnabled = true;\n\n  // Lifecycle hooks\n  constructor() {\n    super(...arguments);\n\n    assert(\n      '<PowerSelectWithCreate> requires an `onCreate` function',\n      this.args.onCreate && typeof this.args.onCreate === 'function',\n    );\n  }\n\n  get powerSelectComponent() {\n    return ensureSafeComponent(\n      this.args.powerSelectComponent || PowerSelectComponent,\n      this,\n    );\n  }\n\n  get suggestedOptionComponent() {\n    return ensureSafeComponent(\n      this.args.suggestedOptionComponent || SuggestedOptionComponent,\n      this,\n    );\n  }\n\n  shouldShowCreateOption(term, options) {\n    return this.args.showCreateWhen\n      ? this.args.showCreateWhen(term, options)\n      : true;\n  }\n\n  addCreateOption(term, results) {\n    if (this.shouldShowCreateOption(term, results)) {\n      if (this.args.showCreatePosition === 'bottom') {\n        results.push(this.buildSuggestionForTerm(term));\n      } else {\n        results.unshift(this.buildSuggestionForTerm(term));\n      }\n    }\n  }\n\n  @action\n  searchAndSuggest(term, select) {\n    return RSVP.resolve(this.args.options).then((newOptions) => {\n      if (term.length === 0) {\n        return newOptions;\n      }\n\n      let searchAction = this.args.search;\n      if (searchAction) {\n        return resolve(searchAction(term, select)).then((results) => {\n          if (results.toArray) {\n            results = results.toArray();\n          }\n          this.addCreateOption(term, results);\n          return results;\n        });\n      }\n\n      newOptions = this.filter(newOptions, term);\n      this.addCreateOption(term, newOptions);\n      return newOptions;\n    });\n  }\n\n  @action\n  selectOrCreate(selection, select, e) {\n    if (selection && selection.__isSuggestion__) {\n      this.args.onCreate(selection.__value__, select, e);\n    } else {\n      this.args.onChange(selection, select, e);\n    }\n  }\n\n  // Methods\n  filter(options, searchText) {\n    let matcher;\n    if (this.args.searchField) {\n      matcher = (option, text) =>\n        this.matcher(get(option, this.args.searchField), text);\n    } else {\n      matcher = (option, text) => this.matcher(option, text);\n    }\n    return filterOptions(options || [], searchText, matcher);\n  }\n\n  buildSuggestionForTerm(term) {\n    return {\n      __isSuggestion__: true,\n      __value__: term,\n      text: this.buildSuggestionLabel(term),\n    };\n  }\n\n  buildSuggestionLabel(term) {\n    if (this.args.buildSuggestion) {\n      return this.args.buildSuggestion(term);\n    }\n\n    return `Add \"${term}\"...`;\n  }\n}\n"],"names":["PowerSelectWithCreateComponent","Component","matcher","defaultMatcher","g","prototype","tracked","i","void 0","constructor","arguments","assert","args","onCreate","powerSelectComponent","ensureSafeComponent","PowerSelectComponent","suggestedOptionComponent","SuggestedOptionComponent","shouldShowCreateOption","term","options","showCreateWhen","addCreateOption","results","showCreatePosition","push","buildSuggestionForTerm","unshift","searchAndSuggest","select","RSVP","resolve","then","newOptions","length","searchAction","search","toArray","filter","n","action","selectOrCreate","selection","e","__isSuggestion__","__value__","onChange","searchText","searchField","option","text","get","filterOptions","buildSuggestionLabel","buildSuggestion","setComponentTemplate","TEMPLATE"],"mappings":"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"}